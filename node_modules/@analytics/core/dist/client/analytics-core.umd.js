!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("analytics-utils"),require("@analytics/global-storage-utils"),require("@analytics/type-utils")):"function"==typeof define&&define.amd?define(["exports","analytics-utils","@analytics/global-storage-utils","@analytics/type-utils"],t):t((e||self)._analytics={},e.analyticsUtils,e.globalStorageUtils,e.typeUtils)}(this,function(e,t,n,r){function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}var a="function",o="undefined",u="@@redux/",c=u+"INIT",s=u+Math.random().toString(36),l=/* #__PURE__ */function(){return typeof Symbol===a&&Symbol.observable||"@@observable"}(),f=" != "+a;function d(e,t,n){var i;if(typeof t===a&&typeof n===o&&(n=t,t=void 0),typeof n!==o){if(typeof n!==a)throw new Error("enhancer"+f);return n(d)(e,t)}if(typeof e!==a)throw new Error("reducer"+f);var u=e,s=t,p=[],m=p,g=!1;function h(){m===p&&(m=p.slice())}function v(){return s}function y(e){if(typeof e!==a)throw new Error("Listener"+f);var t=!0;return h(),m.push(e),function(){if(t){t=!1,h();var n=m.indexOf(e);m.splice(n,1)}}}function b(e){if(!r.isObject(e))throw new Error("Act != obj");if(typeof e.type===o)throw new Error("ActType "+o);if(g)throw new Error("Dispatch in reducer");try{g=!0,s=u(s,e)}finally{g=!1}for(var t=p=m,n=0;n<t.length;n++)(0,t[n])();return e}return b({type:c}),(i={dispatch:b,subscribe:y,getState:v,replaceReducer:function(e){if(typeof e!==a)throw new Error("next reducer"+f);u=e,b({type:c})}})[l]=function(){var e,t=y;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Observer != obj");function n(){e.next&&e.next(v())}return n(),{unsubscribe:t(n)}}})[l]=function(){return this},e},i}function p(e,t){var n=t&&t.type;return"action "+(n&&n.toString()||"?")+"reducer "+e+" returns "+o}function m(){var e=[].slice.call(arguments);return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce(function(e,t){return function(){return e(t.apply(void 0,[].slice.call(arguments)))}})}function g(){var e=arguments;return function(t){return function(n,r,a){var o,u=t(n,r,a),c=u.dispatch,s={getState:u.getState,dispatch:function(e){return c(e)}};return o=[].slice.call(e).map(function(e){return e(s)}),i({},u,{dispatch:c=m.apply(void 0,o)(u.dispatch)})}}}var h=r.PREFIX+"anon_id",v=r.PREFIX+"user_id",y=r.PREFIX+"user_traits",b={__proto__:null,ANON_ID:h,USER_ID:v,USER_TRAITS:y},w="analytics",I="userId",E="anonymousId",P=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],S=["name","EVENTS","config","loaded"],O=P.reduce(function(e,t){return e[t]=t,e},{registerPluginType:function(e){return"registerPlugin:"+e},pluginReadyType:function(e){return"ready:"+e}}),j=/^utm_/,N=/^an_prop_/,A=/^an_trait_/;function _(e){var t=e.storage.setItem;return function(n){return function(r){return function(a){if(a.type===O.bootstrap){var o=a.params,u=a.user,c=a.persistedUser,s=a.initialUser,l=c.userId===u.userId;c.anonymousId!==u.anonymousId&&t(h,u.anonymousId),l||t(v,u.userId),s.traits&&t(y,i({},l&&c.traits?c.traits:{},s.traits));var f=Object.keys(a.params);if(f.length){var d=o.an_uid,p=o.an_event,m=f.reduce(function(e,t){if(t.match(j)||t.match(/^(d|g)clid/)){var n=t.replace(j,"");e.campaign["campaign"===n?"name":n]=o[t]}return t.match(N)&&(e.props[t.replace(N,"")]=o[t]),t.match(A)&&(e.traits[t.replace(A,"")]=o[t]),e},{campaign:{},props:{},traits:{}});n.dispatch(i({type:O.params,raw:o},m,d?{userId:d}:{})),d&&setTimeout(function(){return e.identify(d,m.traits)},0),p&&setTimeout(function(){return e.track(p,m.props)},0),Object.keys(m.campaign).length&&n.dispatch({type:O.campaign,campaign:m.campaign})}}return r(a)}}}}function x(e){return function(t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),n.type===O.setItemEnd){if(n.key===h)return i({},t,{anonymousId:n.value});if(n.key===v)return i({},t,{userId:n.value})}switch(n.type){case O.identify:return Object.assign({},t,{userId:n.userId,traits:i({},t.traits,n.traits)});case O.reset:return[v,h,y].forEach(function(t){e.removeItem(t)}),Object.assign({},t,{userId:null,anonymousId:null,traits:{}});default:return t}}}function k(e){return{userId:e.getItem(v),anonymousId:e.getItem(h),traits:e.getItem(y)}}var T=function(e){return r.PREFIX+"TEMP"+r.PREFIX+e};function z(e){var r=e.storage,a=r.setItem,o=r.removeItem,u=r.getItem;return function(e){return function(r){return function(c){var s=c.userId,l=c.traits,f=c.options;if(c.type===O.reset&&([v,y,h].forEach(function(e){o(e)}),[I,E,"traits"].forEach(function(e){n.remove(T(e))})),c.type===O.identify){u(h)||a(h,t.uuid());var d=u(v),p=u(y)||{};d&&d!==s&&e.dispatch({type:O.userIdChanged,old:{userId:d,traits:p},new:{userId:s,traits:l},options:f}),s&&a(v,s),l&&a(y,i({},p,l))}return r(c)}}}}var M={};function q(e,t){M[e]&&r.isFunction(M[e])&&(M[e](t),delete M[e])}function B(e,t,n){return new Promise(function(r,a){return t()?r(e):n<1?a(i({},e,{queue:!0})):new Promise(function(e){return setTimeout(e,10)}).then(function(i){return B(e,t,n-10).then(r,a)})})}function F(e,t,n){var a=t(),o=e.getState(),u=o.plugins,c=o.queue,s=o.user;if(!o.context.offline&&c&&c.actions&&c.actions.length){var l=c.actions.reduce(function(e,t,n){return u[t.plugin].loaded?(e.process.push(t),e.processIndex.push(n)):(e.requeue.push(t),e.requeueIndex.push(n)),e},{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(l.processIndex&&l.processIndex.length){l.processIndex.forEach(function(t){var o=c.actions[t],l=o.plugin,f=o.payload.type,d=a[l][f];if(d&&r.isFunction(d)){var p=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),[I,E].reduce(function(n,r){return e.hasOwnProperty(r)&&t[r]&&t[r]!==e[r]&&(n[r]=t[r]),n},e)}(o.payload,s);d({payload:p,config:u[l].config,instance:n});var m=f+":"+l;e.dispatch(i({},p,{type:m,_:{called:m,from:"queueDrain"}}))}});var f=c.actions.filter(function(e,t){return!~l.processIndex.indexOf(t)});c.actions=f}}}var U=function(e){var t=e.data,n=e.action,a=e.instance,o=e.state,u=e.allPlugins,c=e.allMatches,s=e.store,l=e.EVENTS;try{var f=o.plugins,d=o.context,p=n.type,m=p.match(R),g=t.exact.map(function(e){return e.pluginName});m&&(g=c.during.map(function(e){return e.pluginName}));var h=function(e,t){return function(n,r,a){var o=r.config,u=r.name,c=u+"."+n.type;a&&(c=a.event);var s=n.type.match(R)?function(e,t,n,r,a){return function(o,u){var c=r?r.name:e,s=u&&H(u)?u:n;if(r&&(!(s=u&&H(u)?u:[e]).includes(e)||1!==s.length))throw new Error("Method "+t+" can only abort "+e+" plugin. "+JSON.stringify(s)+" input valid");return i({},a,{abort:{reason:o,plugins:s,caller:t,_:c}})}}(u,c,t,a,n):function(e,t){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+t)}}(n,c);return{payload:Z(n),instance:e,config:o||{},abort:s}}}(a,g),v=t.exact.reduce(function(e,t){var n=t.pluginName,r=t.methodName,i=!1;return r.match(/^initialize/)||r.match(/^reset/)||(i=!f[n].loaded),d.offline&&r.match(/^(page|track|identify)/)&&(i=!0),e[""+n]=i,e},{});return Promise.resolve(t.exact.reduce(function(e,o,c){var s=o.pluginName;return Promise.resolve(e).then(function(e){function o(){return Promise.resolve(e)}var c=function(){if(t.namespaced&&t.namespaced[s])return Promise.resolve(t.namespaced[s].reduce(function(e,t,n){return Promise.resolve(e).then(function(e){return t.method&&r.isFunction(t.method)?(function(e,t){var n=Y(e);if(n&&n.name===t){var r=Y(n.method);throw new Error([t+" plugin is calling method "+e,"Plugins cant call self","Use "+n.method+" "+(r?"or "+r.method:"")+" in "+t+" plugin insteadof "+e].join("\n"))}}(t.methodName,t.pluginName),Promise.resolve(t.method({payload:e,instance:a,abort:(n=e,o=s,c=t.pluginName,function(e,t){return i({},n,{abort:{reason:e,plugins:t||[o],caller:p,from:c||o}})}),config:X(t.pluginName,f,u),plugins:f})).then(function(t){var n=r.isObject(t)?t:{};return Promise.resolve(i({},e,n))})):e;var n,o,c})},Promise.resolve(n))).then(function(t){e[s]=t});e[s]=n}();return c&&c.then?c.then(o):o()})},Promise.resolve({}))).then(function(e){return Promise.resolve(t.exact.reduce(function(n,o,c){try{var l=t.exact.length===c+1,d=o.pluginName,g=u[d];return Promise.resolve(n).then(function(t){var n=e[d]?e[d]:{};if(m&&(n=t),J(n,d))return C({data:n,method:p,instance:a,pluginName:d,store:s}),Promise.resolve(t);if(J(t,d))return l&&C({data:t,method:p,instance:a,store:s}),Promise.resolve(t);if(v.hasOwnProperty(d)&&!0===v[d])return s.dispatch({type:"queue",plugin:d,payload:n,_:{called:"queue",from:"queueMechanism"}}),Promise.resolve(t);var o=h(e[d],u[d]);return Promise.resolve(g[p]({abort:o.abort,payload:n,instance:a,config:X(d,f,u),plugins:f})).then(function(o){var u=r.isObject(o)?o:{},c=i({},t,u),l=e[d];if(J(l,d))C({data:l,method:p,instance:a,pluginName:d,store:s});else{var f=p+":"+d;(f.match(/:/g)||[]).length<2&&!p.match(L)&&!p.match(V)&&a.dispatch(i({},m?c:n,{type:f,_:{called:f,from:"submethod"}}))}return Promise.resolve(c)})})}catch(e){return Promise.reject(e)}},Promise.resolve(n))).then(function(e){if(!(p.match(R)||p.match(/^registerPlugin/)||p.match(V)||p.match(L)||p.match(/^params/)||p.match(/^userIdChanged/))){if(l.plugins.includes(p),e._&&e._.originalAction===p)return e;var n=i({},e,{_:{originalAction:e.type,called:e.type,from:"engineEnd"}});W(e,t.exact.length)&&!p.match(/End$/)&&(n=i({},n,{type:e.type+"Aborted"})),s.dispatch(n)}return e})})}catch(e){return Promise.reject(e)}},R=/Start$/,L=/^bootstrap/,V=/^ready/;function C(e){var t=e.pluginName,n=e.method+"Aborted"+(t?":"+t:"");e.store.dispatch(i({},e.data,{type:n,_:{called:n,from:"abort"}}))}function X(e,t,n){var r=t[e]||n[e];return r&&r.config?r.config:{}}function $(e,t){return t.reduce(function(t,n){return n[e]?t.concat({methodName:e,pluginName:n.name,method:n[e]}):t},[])}function D(e,t){var n=e.replace(R,""),r=t?":"+t:"";return[""+e+r,""+n+r,n+"End"+r]}function J(e,t){var n=e.abort;return!!n&&(!0===n||K(n,t)||n&&K(n.plugins,t))}function W(e,t){var n=e.abort;if(!n)return!1;if(!0===n||r.isString(n))return!0;var i=n.plugins;return H(n)&&n.length===t||H(i)&&i.length===t}function H(e){return Array.isArray(e)}function K(e,t){return!(!e||!H(e))&&e.includes(t)}function Y(e){var t=e.match(/(.*):(.*)/);return!!t&&{method:t[1],name:t[2]}}function Z(e){return Object.keys(e).reduce(function(t,n){return"type"===n||(t[n]=r.isObject(e[n])?Object.assign({},e[n]):e[n]),t},{})}function G(e,t,n){var a={};return function(o){return function(u){return function(c){try{var s,l=function(e){return s?e:u(p)},f=c.type,d=c.plugins,p=c;if(c.abort)return Promise.resolve(u(c));if(f===O.enablePlugin&&o.dispatch({type:O.initializeStart,plugins:d,disabled:[],fromEnable:!0,meta:c.meta}),f===O.disablePlugin&&setTimeout(function(){return q(c.meta.rid,{payload:c})},0),f===O.initializeEnd){var m=t(),g=Object.keys(m),h=g.filter(function(e){return d.includes(e)}).map(function(e){return m[e]}),v=[],y=[],b=c.disabled,w=h.map(function(e){var t=e.name;return B(e,e.loaded,1e4).then(function(n){return a[t]||(o.dispatch({type:O.pluginReadyType(t),name:t,events:Object.keys(e).filter(function(e){return!S.includes(e)})}),a[t]=!0),v=v.concat(t),e}).catch(function(e){if(e instanceof Error)throw new Error(e);return y=y.concat(e.name),e})});Promise.all(w).then(function(e){var t={plugins:v,failed:y,disabled:b};setTimeout(function(){g.length===w.length+b.length&&o.dispatch(i({},{type:O.ready},t))},0)})}var I=function(){if(f!==O.bootstrap)return/^ready:([^:]*)$/.test(f)&&setTimeout(function(){return F(o,t,e)},0),Promise.resolve(function(e,t,n,a,o){try{var u=r.isFunction(t)?t():t,c=e.type,s=c.replace(R,"");if(e._&&e._.called)return Promise.resolve(e);var l=n.getState(),f=(m=u,void 0===(g=l.plugins)&&(g={}),void 0===(h=e.options)&&(h={}),Object.keys(m).filter(function(e){var t=h.plugins||{};return r.isBoolean(t[e])?t[e]:!1!==t.all&&(!g[e]||!1!==g[e].enabled)}).map(function(e){return m[e]}));c===O.initializeStart&&e.fromEnable&&(f=Object.keys(l.plugins).filter(function(t){var n=l.plugins[t];return e.plugins.includes(t)&&!n.initialized}).map(function(e){return u[e]}));var d=f.map(function(e){return e.name}),p=function(e,t,n){var r=D(e).map(function(e){return $(e,t)});return t.reduce(function(n,r){var i=r.name,a=D(e,i).map(function(e){return $(e,t)}),o=a[0],u=a[1],c=a[2];return o.length&&(n.beforeNS[i]=o),u.length&&(n.duringNS[i]=u),c.length&&(n.afterNS[i]=c),n},{before:r[0],beforeNS:{},during:r[1],duringNS:{},after:r[2],afterNS:{}})}(c,f);return Promise.resolve(U({action:e,data:{exact:p.before,namespaced:p.beforeNS},state:l,allPlugins:u,allMatches:p,instance:n,store:a,EVENTS:o})).then(function(e){function t(){var t=function(){if(c.match(R))return Promise.resolve(U({action:i({},r,{type:s+"End"}),data:{exact:p.after,namespaced:p.afterNS},state:l,allPlugins:u,allMatches:p,instance:n,store:a,EVENTS:o})).then(function(e){e.meta&&e.meta.hasCallback&&q(e.meta.rid,{payload:e})})}();return t&&t.then?t.then(function(){return e}):e}if(W(e,d.length))return e;var r,f=function(){if(c!==s)return Promise.resolve(U({action:i({},e,{type:s}),data:{exact:p.during,namespaced:p.duringNS},state:l,allPlugins:u,allMatches:p,instance:n,store:a,EVENTS:o})).then(function(e){r=e});r=e}();return f&&f.then?f.then(t):t()})}catch(e){return Promise.reject(e)}var m,g,h}(c,t,e,o,n)).then(function(e){var t=u(e);return s=1,t})}();return Promise.resolve(I&&I.then?I.then(l):l(I))}catch(e){return Promise.reject(e)}}}}}function Q(e){return function(t){return function(t){return function(n){var r=n.type,i=n.key,a=n.value,o=n.options;if(r===O.setItem||r===O.removeItem){if(n.abort)return t(n);r===O.setItem?e.setItem(i,a,o):e.removeItem(i,o)}return t(n)}}}}var ee=function(){var e=this;this.before=[],this.after=[],this.addMiddleware=function(t,n){e[n]=e[n].concat(t)},this.removeMiddleware=function(t,n){var r=e[n].findIndex(function(e){return e===t});-1!==r&&(e[n]=[].concat(e[n].slice(0,r),e[n].slice(r+1)))},this.dynamicMiddlewares=function(t){return function(n){return function(r){return function(i){var a={getState:n.getState,dispatch:function(e){return n.dispatch(e)}},o=e[t].map(function(e){return e(a)});return m.apply(void 0,o)(r)(i)}}}}};function te(e){return function(t,n){void 0===t&&(t={});var r={};if("initialize:aborted"===n.type)return t;if(/^registerPlugin:([^:]*)$/.test(n.type)){var a=ne(n.type,"registerPlugin"),o=e()[a];if(!o||!a)return t;var u=n.enabled;return r[a]={enabled:u,initialized:!!u&&Boolean(!o.initialize),loaded:!!u&&Boolean(o.loaded()),config:o.config||{}},i({},t,r)}if(/^initialize:([^:]*)$/.test(n.type)){var c=ne(n.type,O.initialize),s=e()[c];return s&&c?(r[c]=i({},t[c],{initialized:!0,loaded:Boolean(s.loaded())}),i({},t,r)):t}if(/^ready:([^:]*)$/.test(n.type))return r[n.name]=i({},t[n.name],{loaded:!0}),i({},t,r);switch(n.type){case O.disablePlugin:return i({},t,re(n.plugins,!1,t));case O.enablePlugin:return i({},t,re(n.plugins,!0,t));default:return t}}}function ne(e,t){return e.substring(t.length+1,e.length)}function re(e,t,n){return e.reduce(function(e,r){return e[r]=i({},n[r],{enabled:t}),e},n)}function ie(e){try{return JSON.parse(JSON.stringify(e))}catch(e){}return e}var ae={last:{},history:[]};function oe(e,t){void 0===e&&(e=ae);var n=t.options,r=t.meta;if(t.type===O.track){var a=ie(i({event:t.event,properties:t.properties},Object.keys(n).length&&{options:n},{meta:r}));return i({},e,{last:a,history:e.history.concat(a)})}return e}var ue={actions:[]};function ce(e,t){void 0===e&&(e=ue);var n=t.payload;switch(t.type){case"queue":var r;return r=n&&n.type&&n.type===O.identify?[t].concat(e.actions):e.actions.concat(t),i({},e,{actions:r});case"dequeue":return[];default:return e}}var se=/#.*$/;function le(e){var t=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(e);return"/"+(t&&t[3]?t[3].split("?")[0].replace(se,""):"")}var fe,de,pe,me,ge=function(e){if(void 0===e&&(e={}),!r.isBrowser)return e;var t=document,n=t.title,a=t.referrer,o=window,u=o.location,c=o.innerWidth,s=o.innerHeight,l=u.hash,f=u.search,d=function(e){var t=function(){if(r.isBrowser)for(var e,t=document.getElementsByTagName("link"),n=0;e=t[n];n++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}();return t?t.match(/\?/)?t:t+e:window.location.href.replace(se,"")}(f),p={title:n,url:d,path:le(d),hash:l,search:f,width:c,height:s};return a&&""!==a&&(p.referrer=a),i({},p,e)},he={last:{},history:[]};function ve(e,t){void 0===e&&(e=he);var n=t.options;if(t.type===O.page){var r=ie(i({properties:t.properties,meta:t.meta},Object.keys(n).length&&{options:n}));return i({},e,{last:r,history:e.history.concat(r)})}return e}fe=function(){if(!r.isBrowser)return!1;var e=navigator.appVersion;return~e.indexOf("Win")?"Windows":~e.indexOf("Mac")?"MacOS":~e.indexOf("X11")?"UNIX":~e.indexOf("Linux")?"Linux":"Unknown OS"}(),de=r.isBrowser?document.referrer:null,pe=t.getBrowserLocale(),me=t.getTimeZone();var ye={initialized:!1,sessionId:t.uuid(),app:null,version:null,debug:!1,offline:!!r.isBrowser&&!navigator.onLine,os:{name:fe},userAgent:r.isBrowser?navigator.userAgent:"node",library:{name:w,version:"0.11.0"},timezone:me,locale:pe,campaign:{},referrer:de};function be(e,t){void 0===e&&(e=ye);var n=e.initialized,r=t.campaign;switch(t.type){case O.campaign:return i({},e,{campaign:r});case O.offline:return i({},e,{offline:!0});case O.online:return i({},e,{offline:!1});default:return n?e:i({},ye,e,{initialized:!0})}}var we=["plugins","reducers","storage"];function Ie(e,t,n){if(r.isBrowser){var i=window[(n?"add":"remove")+"EventListener"];e.split(" ").forEach(function(e){i(e,t)})}}function Ee(e){var t=Ie.bind(null,"online offline",function(t){return Promise.resolve(!navigator.onLine).then(e)});return t(!0),function(e){return t(!1)}}function Pe(){return n.set(w,[]),function(e){return function(t,r,i){var a=e(t,r,i),o=a.dispatch;return Object.assign(a,{dispatch:function(e){return n.globalContext[n.KEY].analytics.push(e.action||e),o(e)}})}}}function Se(e){return function(){return m(m.apply(null,arguments),Pe())}}function Oe(e){return e?r.isArray(e)?e:[e]:[]}function je(e,n,a){void 0===e&&(e={});var o,u,c=t.uuid();return n&&(M[c]=(o=n,u=function(e){for(var t,n=e||Array.prototype.slice.call(arguments),i=0;i<n.length;i++)if(r.isFunction(n[i])){t=n[i];break}return t}(a),function(e){u&&u(e),o(e)})),i({},e,{rid:c,ts:(new Date).getTime()},n?{hasCallback:!0}:{})}function Ne(e){void 0===e&&(e={});var u=e.reducers||{},l=e.initialUser||{},f=(e.plugins||[]).reduce(function(e,t){if(r.isFunction(t))return e.middlewares=e.middlewares.concat(t),e;if(t.NAMESPACE&&(t.name=t.NAMESPACE),!t.name)throw new Error("https://lytics.dev/errors/1");var n=t.EVENTS?Object.keys(t.EVENTS).map(function(e){return t.EVENTS[e]}):[];e.pluginEnabled[t.name]=!(!1===t.enabled||t.config&&!1===t.config.enabled),delete t.enabled,t.methods&&(e.methods[t.name]=Object.keys(t.methods).reduce(function(e,n){var r;return e[n]=(r=t.methods[n],function(){for(var e=Array.prototype.slice.call(arguments),t=new Array(r.length),n=0;n<e.length;n++)t[n]=e[n];return t[t.length]=$,r.apply({instance:$},t)}),e},{}),delete t.methods);var i=Object.keys(t).concat(n),a=new Set(e.events.concat(i));if(e.events=Array.from(a),e.pluginsArray=e.pluginsArray.concat(t),e.plugins[t.name])throw new Error(t.name+"AlreadyLoaded");return e.plugins[t.name]=t,e.plugins[t.name].loaded||(e.plugins[t.name].loaded=function(){return!0}),e},{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),v=e.storage?e.storage:{getItem:n.get,setItem:n.set,removeItem:n.remove},y=function(e){return function(t,i,a){return i.getState("user")[t]||(a&&r.isObject(a)&&a[t]?a[t]:k(e)[t]||n.get(T(t))||null)}}(v),b=f.plugins,w=f.events.filter(function(e){return!S.includes(e)}).sort(),j=new Set(w.concat(P).filter(function(e){return!S.includes(e)})),N=Array.from(j).sort(),A=function(){return b},M=new ee,q=M.addMiddleware,B=M.removeMiddleware,U=M.dynamicMiddlewares,R=function(){throw new Error("Abort disabled inListener")},L=t.paramsParse(),V=k(v),C=i({},V,l,L.an_uid?{userId:L.an_uid}:{},L.an_aid?{anonymousId:L.an_aid}:{});C.anonymousId||(C.anonymousId=t.uuid());var X=i({enable:function(e,t){return new Promise(function(n){ie.dispatch({type:O.enablePlugin,plugins:Oe(e),_:{originalAction:O.enablePlugin}},n,[t])})},disable:function(e,t){return new Promise(function(n){ie.dispatch({type:O.disablePlugin,plugins:Oe(e),_:{originalAction:O.disablePlugin}},n,[t])})}},f.methods),$={identify:function(e,t,a,o){try{var u=r.isString(e)?e:null,c=r.isObject(e)?e:t,s=a||{},l=$.user();n.set(T(I),u);var f=u||c.userId||y(I,$,c);return Promise.resolve(new Promise(function(e){ie.dispatch(i({type:O.identifyStart,userId:f,traits:c||{},options:s,anonymousId:l.anonymousId},l.id&&l.id!==u&&{previousId:l.id}),e,[t,a,o])}))}catch(e){return Promise.reject(e)}},track:function(e,t,n,i){try{var a=r.isObject(e)?e.event:e;if(!a||!r.isString(a))throw new Error("EventMissing");var o=r.isObject(e)?e:t||{},u=r.isObject(n)?n:{};return Promise.resolve(new Promise(function(e){ie.dispatch({type:O.trackStart,event:a,properties:o,options:u,userId:y(I,$,t),anonymousId:y(E,$,t)},e,[t,n,i])}))}catch(e){return Promise.reject(e)}},page:function(e,t,n){try{var i=r.isObject(e)?e:{},a=r.isObject(t)?t:{};return Promise.resolve(new Promise(function(r){ie.dispatch({type:O.pageStart,properties:ge(i),options:a,userId:y(I,$,i),anonymousId:y(E,$,i)},r,[e,t,n])}))}catch(e){return Promise.reject(e)}},user:function(e){if(e===I||"id"===e)return y(I,$);if(e===E||"anonId"===e)return y(E,$);var n=$.getState("user");return e?t.dotProp(n,e):n},reset:function(e){return new Promise(function(t){ie.dispatch({type:O.resetStart},t,e)})},ready:function(e){return $.on(O.ready,e)},on:function(e,t){if(!e||!r.isFunction(t))return!1;if(e===O.bootstrap)throw new Error(".on disabled for "+e);var n=/Start$|Start:/;if("*"===e){var i=function(e){return function(e){return function(r){return r.type.match(n)&&t({payload:r,instance:$,plugins:b}),e(r)}}},a=function(e){return function(e){return function(r){return r.type.match(n)||t({payload:r,instance:$,plugins:b}),e(r)}}};return q(i,Ae),q(a,_e),function(){B(i,Ae),B(a,_e)}}var o=e.match(n)?Ae:_e,u=function(n){return function(n){return function(r){return r.type===e&&t({payload:r,instance:$,plugins:b,abort:R}),n(r)}}};return q(u,o),function(){return B(u,o)}},once:function(e,t){if(!e||!r.isFunction(t))return!1;if(e===O.bootstrap)throw new Error(".once disabled for "+e);var n=$.on(e,function(e){t({payload:e.payload,instance:$,plugins:b,abort:R}),n()});return n},getState:function(e){var n=ie.getState();return e?t.dotProp(n,e):Object.assign({},n)},dispatch:function(e){var t=r.isString(e)?{type:e}:e;if(P.includes(t.type))throw new Error("reserved action "+t.type);var n=i({},t,{_:i({originalAction:t.type},e._||{})});ie.dispatch(n)},enablePlugin:X.enable,disablePlugin:X.disable,plugins:X,storage:{getItem:v.getItem,setItem:function(e,t,n){ie.dispatch({type:O.setItemStart,key:e,value:t,options:n})},removeItem:function(e,t){ie.dispatch({type:O.removeItemStart,key:e,options:t})}},setAnonymousId:function(e,t){$.storage.setItem(h,e,t)},events:{core:P,plugins:w}},D=f.middlewares.concat([function(e){return function(e){return function(t){return t.meta||(t.meta=je()),e(t)}}},U(Ae),G($,A,{all:N,plugins:w}),Q(v),_($),z($),U(_e)]),J={context:be,user:x(v),page:ve,track:oe,plugins:te(A),queue:ce},W=m,H=m;if(r.isBrowser&&e.debug){var K=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;K&&(W=K({trace:!0,traceLimit:25})),H=function(){return 0===arguments.length?Pe():r.isObject(typeof arguments[0])?Se():Se().apply(null,arguments)}}var Y,Z=function(e){return Object.keys(e).reduce(function(t,n){return we.includes(n)||(t[n]=e[n]),t},{})}(e),ne=f.pluginsArray.reduce(function(e,t){var n=t.name,r=t.config,i=t.loaded,a=f.pluginEnabled[n];return e[n]={enabled:a,initialized:!!a&&Boolean(!t.initialize),loaded:Boolean(i()),config:r||{}},e},{}),re={context:Z,user:C,plugins:ne},ie=d(function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];typeof e[i]===a&&(n[i]=e[i])}var u,l=Object.keys(n);try{!function(e){Object.keys(e).forEach(function(t){var n=e[t];if(typeof n(void 0,{type:c})===o||typeof n(void 0,{type:s})===o)throw new Error("reducer "+t+" "+o)})}(n)}catch(e){u=e}return function(e,t){if(void 0===e&&(e={}),u)throw u;for(var r=!1,i={},a=0;a<l.length;a++){var c=l[a],s=e[c],f=(0,n[c])(s,t);if(typeof f===o){var d=p(c,t);throw new Error(d)}i[c]=f,r=r||f!==s}return r?i:e}}(i({},J,u)),re,H(W(g.apply(void 0,D))));ie.dispatch=(Y=ie.dispatch,function(e,t,n){var r=i({},e,{meta:je(e.meta,t,Oe(n))});return Y.apply(null,[r])});var ae=Object.keys(b);ie.dispatch({type:O.bootstrap,plugins:ae,config:Z,params:L,user:C,initialUser:l,persistedUser:V});var ue=ae.filter(function(e){return f.pluginEnabled[e]}),se=ae.filter(function(e){return!f.pluginEnabled[e]});return ie.dispatch({type:O.registerPlugins,plugins:ae,enabled:f.pluginEnabled}),f.pluginsArray.map(function(e,t){var n=e.bootstrap,i=e.config,a=e.name;n&&r.isFunction(n)&&n({instance:$,config:i,payload:e}),ie.dispatch({type:O.registerPluginType(a),name:a,enabled:f.pluginEnabled[a],plugin:e}),f.pluginsArray.length===t+1&&ie.dispatch({type:O.initializeStart,plugins:ue,disabled:se})}),Ee(function(e){ie.dispatch({type:e?O.offline:O.online})}),function(e,t,n){setInterval(function(){return F(e,t,n)},3e3)}(ie,A,$),$}var Ae="before",_e="after";e.Analytics=Ne,e.CONSTANTS=b,e.EVENTS=O,e.default=Ne,e.init=Ne});
//# sourceMappingURL=analytics-core.umd.js.map
